
# JupiterOne 2021.82 Release

October 14, 2021

## AWS Integration Enhancements

J1 recently discovered some ineffective relationships were being created between the `google_iam_role` and several entities which may be causing incorrect permissions to be reported in queries.

In order to correct this, a `google_iam_binding` entity has been added to the Google Cloud integration that better represents how permissions are associated with principals in Google Cloud.

### What has changed?

- Added support for ingesting the following new entity:

| Resource           | Entity `_type`       | Entity `_class` |
| ------------------ | -------------------- | --------------- |
| IAM Binding        | `google_iam_binding` | `AccessPolicy` |

- Added support for ingesting the following new relationships:

| Source Entity `_type`      | Relationship `_class` | Target Entity `_type`               |
| -------------------------- | --------------------- | ----------------------------------- |
| `google_iam_binding`       | **ASSIGNED**          | `google_iam_service_account`        |
| `google_iam_binding`       | **ASSIGNED**          | `google_user`                       |
| `google_iam_binding`       | **ASSIGNED**          | `google_group`                      |
| `google_iam_binding`       | **ASSIGNED**          | `google_domain`                     |
| `google_iam_binding`       | **ASSIGNED**          | `google_iam_role`                   |
| `google_iam_binding`       | **ASSIGNED**          | `everyone`                          |
| `google_iam_binding`       | **ASSIGNED**          | `google_cloud_authenticated_users`  |
| `google_iam_binding`       | **USES**              | `google_iam_role`                   |
| `google_iam_binding`       | **ALLOWS**            | `ANY_RESOURCE`                      |
| `google_cloud_api_service` | **HAS**               | `ANY_RESOURCE`                      |

- Removed the following relationships:

| Source Entity `_type`              | Relationship `_class` | Target Entity `_type`  |
| ---------------------------------- | --------------------- | ---------------------- |
| `google_user`                      | **ASSIGNED**          | `google_iam_role`      |
| `google_group`                     | **ASSIGNED**          | `google_iam_role`      |
| `google_domain`                    | **ASSIGNED**          | `google_iam_role`      |
| `everyone`                         | **ASSIGNED**          | `google_iam_role`      |
| `google_cloud_authenticated_users` | **ASSIGNED**          | `google_iam_role`      |
| `google_iam_service_account`       | **ASSIGNED**          | `google_iam_role`      |

- `google_iam_binding` ingestion will take place in the `fetch-iam-bindings` step instead of the `fetch-resource-manager-iam-policy` step, which has been removed. If an integration does not use the configure organization projects option in the configuration, this step will use the project scope to fetch IAM policies.

### Customer Impact

As a result of these change customers should be aware of the following:

- For the integration to properly ingest the IAM bindings the Cloud Asset API (cloudasset.googleapis.com) needs to be enabled in your Google Cloud account.  If this API is not enabled, the step that imports the IAM bindings will be skipped during ingestion. For additional details on enabling the Cloud Asset API see the [J1 Documentation](https://github.com/JupiterOne/graph-google-cloud/blob/main/docs/jupiterone.md#in-google-cloud) and the [Google Cloud Documentation](https://console.cloud.google.com/apis/library/cloudasset.googleapis.com).

- Traversal queries in J1 that previously queried a relationship directly between the `google_iam_role` and the principal member of your Google account will need to go through the `google_iam_binding_entity`. For example, `Find google_user ASSIGNED google_iam_role` will need to be changed to `Find google_user that ASSIGNED google_iam_binding that USES google_iam_role`.

- The following queries in the question library have been updated based on these changes:
  - “Ensure that IAM users are not assigned the Service Account User or Service Account Token Creator roles at project level"
  - “Ensure that Service Account has no Admin privileges”

### Additional Information

- There is a new [blog post](https://try.jupiterone.com/blog/google-cloud-storage-access-analysis) from J1 Engineering that goes in to more detail about these changes.

- The code for the changes is available in the public repo on GitHub, along with the changelog file:
  - Repo: https://github.com/JupiterOne/graph-google-cloud
  - Changelog: https://github.com/JupiterOne/graph-google-cloud/blob/main/CHANGELOG.md